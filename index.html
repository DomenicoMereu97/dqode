<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEQODE | Dynamic QR Redirector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #000;
            color: #fff;
        }

        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .animate-spin-slow {
            animation: spin 3s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        /* Android Keypad Effect */
        .keypad-btn:active {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        const { motion, AnimatePresence } = window.Motion || { motion: (p) => <div {...p} />, AnimatePresence: (p) => p.children };

        // Icons Helper
        const Icon = ({ name, size = 24, className = "" }) => {
            const iconRef = useRef(null);
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [name]);
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        const parseIngestedContent = (content) => {
            const items = [];
            // 1. Python/Swift/JS Style Tuples/Arrays: ("Name", "https://...") or ["Name", "https://..."]
            const tupleRegex = /["']([^"']+)["']\s*,\s*["'](https?:\/\/[^"']+)["']/g;
            let match;
            while ((match = tupleRegex.exec(content)) !== null) {
                items.push({ id: 'i' + Math.random().toString(36).substr(2, 9), name: match[1], link: match[2] });
            }
            if (items.length > 0) return items;

            // 2. JSON-like objects: { "name": "...", "link": "..." }
            const objRegex = /["'](?:name|title|label)["']\s*:\s*["']([^"']+)["']\s*,\s*["'](?:link|url|href)["']\s*:\s*["'](https?:\/\/[^"']+)["']/g;
            while ((match = objRegex.exec(content)) !== null) {
                items.push({ id: 'i' + Math.random().toString(36).substr(2, 9), name: match[1], link: match[2] });
            }
            if (items.length > 0) return items;

            // 3. Markdown links: [Name](URL)
            const mdRegex = /\[([^\]]+)\]\((https?:\/\/[^\)]+)\)/g;
            while ((match = mdRegex.exec(content)) !== null) {
                items.push({ id: 'i' + Math.random().toString(36).substr(2, 9), name: match[1], link: match[2] });
            }
            if (items.length > 0) return items;

            // 4. Simple Line Format: Name : URL or Name - URL or Name URL
            const lines = content.split('\n');
            lines.forEach(line => {
                const urlMatch = line.match(/(https?:\/\/[^\s]+)/);
                if (urlMatch) {
                    const link = urlMatch[1];
                    let name = line.replace(link, '').trim();
                    // Clean up common separators like :, -, numbers at start
                    name = name.replace(/^[\d\.\-\s\:\)\(]+|[\:\-\s\)\(]+$/g, '').trim();
                    if (!name) name = "Link " + (items.length + 1);
                    items.push({ id: 'i' + Math.random().toString(36).substr(2, 9), name, link });
                }
            });

            return items;
        };

        const STORAGE_KEY = 'deqode_state_v1';

        const defaultState = {
            lists: [
                {
                    id: 'l1',
                    name: 'Marketing',
                    items: [
                        { id: 'i1', name: 'Google', link: 'https://google.com' },
                        { id: 'i2', name: 'Apple', link: 'https://apple.com' },
                        { id: 'i3', name: 'Amazon', link: 'https://amazon.com' },
                    ]
                }
            ],
            activeListId: 'l1',
            activeItemId: 'i1'
        };

        const App = () => {
            const [view, setView] = useState('dashboard'); // dashboard, lock, qr, redirect
            const [state, setState] = useState(() => {
                const saved = localStorage.getItem(STORAGE_KEY);
                return saved ? JSON.parse(saved) : defaultState;
            });

            useEffect(() => {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
                // Sync across tabs
                const handleStorage = (e) => {
                    if (e.key === STORAGE_KEY) setState(JSON.parse(e.newValue));
                };
                window.addEventListener('storage', handleStorage);
                return () => window.removeEventListener('storage', handleStorage);
            }, [state]);

            // Sync with Server for Dynamic Redirect
            useEffect(() => {
                const list = state.lists.find(l => l.id === state.activeListId);
                const item = list?.items.find(i => i.id === state.activeItemId);
                if (item) {
                    fetch(`/api/set-target?url=${encodeURIComponent(item.link)}`)
                        .catch(err => console.log("Standalone mode or server unreachable"));
                }
            }, [state.activeListId, state.activeItemId, state.lists]);

            // Invisible Instant Redirect (Fallback for static files)
            useEffect(() => {
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('r') === '1') {
                    const list = state.lists.find(l => l.id === state.activeListId);
                    const item = list?.items.find(i => i.id === state.activeItemId);
                    if (item) {
                        window.location.replace(item.link);
                    }
                }
            }, []);

            const updateState = (updates) => setState(prev => ({ ...prev, ...updates }));

            const activeLink = useMemo(() => {
                const list = state.lists.find(l => l.id === state.activeListId);
                const item = list?.items.find(i => i.id === state.activeItemId);
                return item?.link || 'https://google.com';
            }, [state]);

            const toggleFullscreen = () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen().catch(err => {
                        console.log(`Error attempting to enable full-screen mode: ${err.message}`);
                    });
                }
            };

            useEffect(() => {
                if (view === 'lock') {
                    toggleFullscreen();
                }
            }, [view]);

            return (
                <div className="min-h-screen" onClick={view === 'lock' ? toggleFullscreen : undefined}>
                    <AnimatePresence mode="wait">
                        {view === 'dashboard' && <Dashboard key="dash" state={state} updateState={updateState} setView={setView} />}
                        {view === 'lock' && <LockScreen key="lock" state={state} updateState={updateState} setView={setView} />}
                        {view === 'qr' && <QRView key="qr" activeLink={activeLink} setView={setView} />}
                        {view === 'redirect' && <RedirectView key="red" activeLink={activeLink} />}
                    </AnimatePresence>
                </div>
            );
        };

        const Dashboard = ({ state, updateState, setView }) => {
            const [newListName, setNewListName] = useState('');
            const [showImport, setShowImport] = useState(false);
            const [importTargetListId, setImportTargetListId] = useState(null); // null means new list

            const addList = () => {
                if (!newListName) return;
                const newList = { id: 'l' + Date.now(), name: newListName, items: [] };
                updateState({ lists: [...state.lists, newList] });
                setNewListName('');
            };

            const deleteList = (id) => {
                updateState({ lists: state.lists.filter(l => l.id !== id) });
            };

            const addItem = (listId) => {
                const newItem = { id: 'i' + Date.now(), name: 'New Link', link: 'https://' };
                const newLists = state.lists.map(l => l.id === listId ? { ...l, items: [...l.items, newItem] } : l);
                updateState({ lists: newLists });
            };

            const updateItem = (listId, itemId, updates) => {
                const newLists = state.lists.map(l => l.id === listId ? { ...l, items: l.items.map(i => i.id === itemId ? { ...i, ...updates } : i) } : l);
                updateState({ lists: newLists });
            };

            const selectItem = (listId, itemId) => {
                updateState({ activeListId: listId, activeItemId: itemId });
            };

            const handleImport = (items) => {
                if (importTargetListId) {
                    // Append to existing list
                    const newLists = state.lists.map(l => l.id === importTargetListId ? { ...l, items: [...l.items, ...items] } : l);
                    updateState({ lists: newLists });
                } else {
                    // Create new list
                    const newList = { id: 'l' + Date.now(), name: 'Imported List', items };
                    updateState({ lists: [...state.lists, newList], activeListId: newList.id, activeItemId: items[0]?.id });
                }
                setShowImport(false);
                setImportTargetListId(null);
            };

            return (
                <div className="p-6 md:p-12 max-w-7xl mx-auto animate-fade-in">
                    <header className="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 mb-12">
                        <div>
                            <h1 className="text-5xl font-extrabold tracking-tighter bg-gradient-to-r from-blue-400 to-purple-600 bg-clip-text text-transparent">DEQODE</h1>
                            <p className="text-white/40 mt-2 font-medium">Dynamic QR Destination Manager</p>
                        </div>
                        <div className="flex gap-4">
                            <button onClick={() => setView('qr')} className="glass px-6 py-3 rounded-2xl flex items-center gap-2 hover:bg-white/10 transition-all font-semibold uppercase tracking-wider text-xs">
                                <Icon name="qr-code" size={18} /> View QR
                            </button>
                            <button onClick={() => setView('lock')} className="glass px-6 py-3 rounded-2xl flex items-center gap-2 hover:bg-white/10 transition-all font-semibold uppercase tracking-wider text-xs bg-blue-600/20 border-blue-500/30">
                                <Icon name="smartphone" size={18} /> Lock Screen
                            </button>
                        </div>
                    </header>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        {/* New List Card */}
                        <div className="glass p-8 rounded-3xl border-dashed border-2 flex flex-col justify-center gap-4">
                            <h2 className="text-xl font-bold mb-2">Create New List</h2>
                            <div className="flex flex-col gap-3">
                                <input
                                    type="text" value={newListName} onChange={e => setNewListName(e.target.value)}
                                    placeholder="List title..." className="bg-transparent border-b-2 border-white/10 p-3 outline-none focus:border-blue-500 transition-all font-semibold"
                                />
                                <button onClick={addList} className="bg-blue-600 p-4 rounded-2xl font-bold flex gap-2 items-center justify-center hover:bg-blue-500 transition-all">
                                    <Icon name="plus" size={20} /> Add List
                                </button>
                                <div className="relative flex items-center py-2">
                                    <div className="flex-grow border-t border-white/5"></div>
                                    <span className="flex-shrink mx-4 text-[10px] font-black text-white/20 uppercase tracking-widest">or</span>
                                    <div className="flex-grow border-t border-white/5"></div>
                                </div>
                                <button onClick={() => { setImportTargetListId(null); setShowImport(true); }} className="p-4 rounded-2xl border border-white/10 font-bold flex gap-2 items-center justify-center hover:bg-white/5 transition-all text-sm uppercase tracking-wider">
                                    <Icon name="file-text" size={18} /> Bulk Import
                                </button>
                            </div>
                        </div>

                        {state.lists.map(list => (
                            <div key={list.id} className="glass p-8 rounded-3xl flex flex-col gap-6 relative group overflow-hidden">
                                <div className="absolute top-0 left-0 w-1 h-full bg-blue-500 opacity-0 group-hover:opacity-100 transition-all" />
                                <div className="flex justify-between items-center">
                                    <h2 className="text-2xl font-bold tracking-tight">{list.name}</h2>
                                    <div className="flex gap-2">
                                        <button onClick={() => { setImportTargetListId(list.id); setShowImport(true); }} className="text-white/20 hover:text-blue-400 transition-all" title="Import to this list">
                                            <Icon name="upload" size={18} />
                                        </button>
                                        <button onClick={() => deleteList(list.id)} className="text-white/20 hover:text-red-500 transition-all">
                                            <Icon name="trash-2" size={18} />
                                        </button>
                                    </div>
                                </div>

                                <div className="space-y-4 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar">
                                    {list.items.map((item, idx) => {
                                        const isActive = state.activeItemId === item.id && state.activeListId === list.id;
                                        return (
                                            <div key={item.id} className={`p-4 rounded-2xl border transition-all ${isActive ? 'bg-blue-600/20 border-blue-500' : 'bg-white/5 border-white/10'}`}>
                                                <div className="flex items-center gap-2 mb-3">
                                                    <span className="text-[10px] font-bold text-white/30 uppercase">Index {idx + 1}</span>
                                                    <input
                                                        className="bg-transparent font-bold outline-none flex-1 truncate"
                                                        value={item.name}
                                                        onChange={e => updateItem(list.id, item.id, { name: e.target.value })}
                                                    />
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <input
                                                        className="bg-transparent text-xs text-white/40 outline-none flex-1 truncate"
                                                        value={item.link}
                                                        onChange={e => updateItem(list.id, item.id, { link: e.target.value })}
                                                    />
                                                    <button
                                                        onClick={() => selectItem(list.id, item.id)}
                                                        className={`px-4 py-1.5 rounded-full text-[10px] font-bold uppercase tracking-widest transition-all ${isActive ? 'bg-blue-500 shadow-lg shadow-blue-500/40' : 'hover:bg-white/10'}`}
                                                    >
                                                        {isActive ? 'Active' : 'Select'}
                                                    </button>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>

                                <button onClick={() => addItem(list.id)} className="w-full py-4 border-2 border-dashed border-white/10 rounded-2xl text-white/30 hover:text-white hover:border-white/30 transition-all flex items-center justify-center gap-2 font-bold uppercase text-xs">
                                    <Icon name="plus" size={16} /> Add Link
                                </button>
                            </div>
                        ))}
                    </div>

                    {showImport && <BulkImport onImport={handleImport} onClose={() => setShowImport(false)} />}
                </div>
            );
        };

        const BulkImport = ({ onImport, onClose }) => {
            const [text, setText] = useState('');
            const fileInputRef = useRef(null);

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    setText(event.target.result);
                };
                reader.readAsText(file);
            };

            const runImport = () => {
                const parsed = parseIngestedContent(text);
                if (parsed.length > 0) {
                    onImport(parsed);
                } else {
                    alert("No links found in the text. Format should be 'Name: URL', [Name](URL), or Python tuples.");
                }
            };

            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/80 backdrop-blur-xl animate-fade-in shadow-2xl">
                    <motion.div
                        initial={{ opacity: 0, scale: 0.9, y: 20 }}
                        animate={{ opacity: 1, scale: 1, y: 0 }}
                        exit={{ opacity: 0, scale: 0.9, y: 20 }}
                        className="glass w-full max-w-2xl p-8 rounded-[2.5rem] flex flex-col gap-6 shadow-2xl relative border-white/20"
                    >
                        <button onClick={onClose} className="absolute top-6 right-6 text-white/40 hover:text-white transition-all bg-white/10 p-2 rounded-full">
                            <Icon name="x" size={20} />
                        </button>

                        <div>
                            <h2 className="text-3xl font-black tracking-tighter bg-gradient-to-r from-blue-400 to-purple-600 bg-clip-text text-transparent">BULK INGEST</h2>
                            <p className="text-white/40 text-sm mt-1 font-medium">Inject text, code, or files generated by an LLM.</p>
                        </div>

                        <div className="relative">
                            <textarea
                                className="bg-black/40 border border-white/10 rounded-2xl p-6 h-80 text-xs font-mono focus:border-blue-500 outline-none w-full custom-scrollbar resize-none placeholder:text-white/10"
                                placeholder={"Paste here. We support many formats:\n\n1. Markdown: [Google](https://google.com)\n2. Python: ('Google', 'https://google.com')\n3. Plain text: Google - https://google.com\n4. JSON: {\"name\": \"Google\", \"link\": \"...\"}"}
                                value={text}
                                onChange={(e) => setText(e.target.value)}
                            />
                            <div className="absolute bottom-4 right-4 flex gap-2">
                                <button
                                    onClick={() => setText('')}
                                    className="px-3 py-1.5 rounded-lg bg-white/5 hover:bg-white/10 text-[10px] font-bold uppercase tracking-widest text-white/30 transition-all"
                                >
                                    Clear
                                </button>
                            </div>
                        </div>

                        <div className="flex gap-4">
                            <button
                                onClick={() => fileInputRef.current.click()}
                                className="flex-1 py-4 rounded-2xl border border-white/10 text-white/60 hover:text-white hover:bg-white/5 transition-all flex items-center justify-center gap-2 font-bold text-xs uppercase tracking-widest"
                            >
                                <Icon name="file-text" size={16} /> Upload
                            </button>
                            <input type="file" ref={fileInputRef} className="hidden" onChange={handleFileChange} />

                            <button
                                onClick={runImport}
                                className="flex-[2] py-4 rounded-2xl bg-blue-600 hover:bg-blue-500 transition-all font-bold flex items-center justify-center gap-3 text-xs uppercase tracking-[0.2em] shadow-lg shadow-blue-500/20"
                            >
                                <Icon name="zap" size={18} /> Inject Now
                            </button>
                        </div>
                    </motion.div>
                </div>
            );
        };

        const QRView = ({ activeLink, setView }) => {
            const canvasRef = useRef(null);
            const isLocalhost = window.location.hostname === 'localhost';
            const redirectUrl = useMemo(() => {
                const base = window.location.href.split('?')[0];
                const normalizedBase = base.endsWith('/') ? base.slice(0, -1) : base;
                return normalizedBase + '/r';
            }, []);

            useEffect(() => {
                if (window.QRious && canvasRef.current) {
                    new QRious({
                        element: canvasRef.current,
                        value: redirectUrl,
                        size: 320,
                        level: 'H',
                        foreground: '#000000',
                        background: '#ffffff'
                    });
                }
            }, [redirectUrl]);

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-8 bg-[#050505]">
                    <button onClick={() => setView('dashboard')} className="absolute top-12 left-12 flex items-center gap-2 text-white/30 hover:text-white transition-all uppercase tracking-widest text-xs font-bold">
                        <Icon name="arrow-left" size={18} /> Back
                    </button>

                    <div className="glass p-12 rounded-[3rem] flex flex-col items-center gap-8 shadow-2xl border-white/5">
                        <div className="p-6 bg-white rounded-[2.5rem] shadow-2xl">
                            <canvas ref={canvasRef} width="320" height="320" className="max-w-full h-auto"></canvas>
                        </div>

                        <div className="text-center">
                            <h2 className="text-3xl font-black mb-4 tracking-tighter">DYNAMIC REDIRECT</h2>
                            <p className="text-white/30 max-w-sm mb-8 font-medium">This QR never changes. Its target is updated instantly from your control panel or lock screen.</p>

                            <div className="flex flex-col items-center gap-3">
                                <span className="text-[10px] font-black uppercase tracking-[0.2em] text-blue-400">Current Target</span>
                                <div className="glass px-6 py-3 rounded-full flex items-center gap-4 border-white/10">
                                    <span className="text-sm font-mono truncate max-w-[200px]">{activeLink}</span>
                                    <Icon name="refresh-cw" size={14} className="animate-spin-slow text-blue-500" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const LockScreen = ({ state, updateState, setView }) => {
            const [pin, setPin] = useState('');
            const [time, setTime] = useState(new Date());
            const [hint, setHint] = useState(false);
            const [feedback, setFeedback] = useState('');

            useEffect(() => {
                const i = setInterval(() => setTime(new Date()), 10000);
                return () => clearInterval(i);
            }, []);

            const activeList = state.lists.find(l => l.id === state.activeListId);

            const handlePin = (n) => { if (pin.length < 8) setPin(p => p + n); };
            const handleClear = () => setPin(p => p.slice(0, -1));

            const handleEmergency = () => {
                const idx = state.lists.findIndex(l => l.id === state.activeListId);
                const next = state.lists[(idx + 1) % state.lists.length];
                updateState({ activeListId: next.id });
                setHint(true);
                setTimeout(() => setHint(false), 1500);
            };

            const handleOk = () => {
                if (!pin) return;
                let val = parseInt(pin);
                let targetIdx = val >= 1000 && val % 1000 === 0 ? (val / 1000) - 1 : val - 1;

                if (activeList && activeList.items[targetIdx]) {
                    const item = activeList.items[targetIdx];
                    updateState({ activeItemId: item.id });
                    setFeedback(item.name);
                    setPin('');
                } else {
                    setFeedback('ERR');
                }
                setTimeout(() => setFeedback(''), 1200);
            };

            return (
                <div className="fixed inset-0 bg-[#0c1a21] z-50 flex flex-col items-center justify-between py-12 select-none overflow-hidden font-sans">
                    <div className="z-10 text-center mt-6">
                        <h1 className="text-[80px] font-extralight text-white/90 leading-none mb-2">
                            {time.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: false })}
                        </h1>
                        <p className="text-xl text-white/70 font-normal lowercase">
                            {time.toLocaleDateString('it-IT', { weekday: 'short', day: 'numeric', month: 'long' })}
                        </p>
                    </div>

                    <div className="z-10 w-full max-w-[340px] px-8 flex-1 flex flex-col justify-center">
                        <div className="flex flex-col items-center mb-10">
                            <div className="flex gap-6 mb-8">
                                {[...Array(4)].map((_, i) => (
                                    <div key={i} className={`w-[11px] h-[11px] rounded-full border border-white/40 transition-all duration-150 ${i < pin.length ? 'bg-white' : 'bg-transparent'}`} />
                                ))}
                            </div>
                            <div className="h-4 flex items-center">
                                <AnimatePresence mode="wait">
                                    {feedback ? (
                                        <motion.div
                                            key="fb" initial={{ opacity: 0 }} animate={{ opacity: 0.15 }} exit={{ opacity: 0 }}
                                            className="text-[9px] text-white font-bold uppercase tracking-[0.4em]"
                                        >
                                            {feedback}
                                        </motion.div>
                                    ) : (
                                        <motion.div
                                            key="ins" initial={{ opacity: 0 }} animate={{ opacity: 0.6 }} exit={{ opacity: 0 }}
                                            className="text-[11px] text-white font-medium tracking-[0.2em] uppercase"
                                        >
                                            Inserisci il PIN
                                        </motion.div>
                                    )}
                                </AnimatePresence>
                            </div>
                        </div>

                        <div className="grid grid-cols-3 gap-y-5 gap-x-4">
                            {[1, 2, 3, 4, 5, 6, 7, 8, 9].map(n => (
                                <button key={n} onClick={() => handlePin(n)} className="w-[75px] h-[75px] rounded-full bg-white/[0.08] flex items-center justify-center text-[32px] font-normal text-white/90 active:bg-white/20 transition-colors mx-auto">{n}</button>
                            ))}

                            <button onClick={handleEmergency} className="w-full flex items-center justify-center text-[11px] font-bold text-white/80 uppercase tracking-widest active:opacity-50 transition-opacity">
                                EMERGENZA
                            </button>

                            <button onClick={() => handlePin(0)} className="w-[75px] h-[75px] rounded-full bg-white/[0.08] flex items-center justify-center text-[32px] font-normal text-white/90 active:bg-white/20 transition-colors mx-auto">0</button>

                            <button onClick={handleClear} onDoubleClick={() => setView('dashboard')} className="w-full h-full flex items-center justify-center text-white/70 active:opacity-50 transition-opacity">
                                <Icon name="delete" size={28} />
                            </button>
                        </div>

                        {/* Large Invisible OK Trigger */}
                        <div className="mt-4 flex justify-center h-20">
                            <button
                                onClick={handleOk}
                                className="w-full h-full bg-transparent outline-none border-none cursor-default active:bg-white/[0.01]"
                                aria-label="Confirm"
                            />
                        </div>
                    </div>

                    <div className="z-10 w-full flex flex-col items-center pb-4">
                        <AnimatePresence>
                            {hint && (
                                <motion.div
                                    initial={{ opacity: 0 }} animate={{ opacity: 0.12 }} exit={{ opacity: 0 }}
                                    className="text-[9px] text-white font-bold tracking-[0.4em] uppercase"
                                >
                                    {activeList?.name}
                                </motion.div>
                            )}
                        </AnimatePresence>

                    </div>
                </div>
            );
        };

        const RedirectView = ({ activeLink }) => {
            return (
                <div className="min-h-screen flex flex-col items-center justify-center gap-8 bg-black font-mono">
                    <div className="relative">
                        <div className="w-16 h-16 border-4 border-blue-500/20 border-t-blue-500 rounded-full animate-spin" />
                        <div className="absolute inset-0 flex items-center justify-center">
                            <i data-lucide="external-link" className="w-6 h-6 text-blue-500/40"></i>
                        </div>
                    </div>
                    <div className="text-center space-y-2">
                        <p className="text-blue-500/60 text-xs font-black uppercase tracking-[0.4em]">Redirecting</p>
                        <p className="text-white/20 text-[10px] truncate max-w-[250px]">{activeLink}</p>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        const isRedirect = new URLSearchParams(window.location.search).get('r') === '1';

        if (isRedirect) {
            // Render nothing or just a black screen during the micro-second of redirect
            root.render(<div className="bg-black min-h-screen"></div>);
        } else {
            root.render(<App />);
        }
    </script>
</body>

</html>